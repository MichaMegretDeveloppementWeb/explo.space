import{L as d,g as p}from"./map-responsive-config-DdMpAmdA.js";import{c as f}from"./marker-icon-utils-Ct1xqS19.js";import{R as b}from"./recaptcha-service-C60lUiXK.js";const g={primary:{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors Â© <a href="https://carto.com/attributions">CARTO</a>',subdomains:["a","b","c","d"],maxZoom:19,get minZoom(){return p()}},fallback:{url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19,get minZoom(){return p()}}};function h(t){const e=document.getElementById("edit-request-map-data");if(!e){console.error("Map data element not found");return}const o=parseFloat(e.dataset.lat),n=parseFloat(e.dataset.lng);if(isNaN(o)||isNaN(n)){console.error("Invalid coordinates for edit request map");return}const s=d.map(t,{center:[o,n],zoom:15,maxBounds:[[-90,-180],[90,180]],maxBoundsViscosity:1});w(s);const a=d.marker([o,n],{icon:f(),draggable:!0,autoPan:!0}).addTo(s);a.bindPopup("DÃ©placez le marqueur pour modifier la position").openPopup(),a.on("dragend",function(i){const r=i.target.getLatLng();L(r.lat,r.lng)}),y(s,a,e),setTimeout(()=>{s.invalidateSize()},100)}function w(t){const e=g.primary,o=g.fallback,n=d.tileLayer(e.url,{attribution:e.attribution,subdomains:e.subdomains,maxZoom:e.maxZoom,minZoom:e.minZoom});n.on("tileerror",()=>{console.warn("CartoDB tiles failed, switching to OSM fallback"),t.removeLayer(n),d.tileLayer(o.url,{attribution:o.attribution,maxZoom:o.maxZoom,minZoom:o.minZoom}).addTo(t)}),n.addTo(t)}function L(t,e){const o=Math.round(t*1e6)/1e6,n=Math.round(e*1e6)/1e6;window.dispatchEvent(new CustomEvent("map-geocoding-started")),window.Livewire.dispatch("update-coordinates-from-map",{lat:o,lng:n})}function y(t,e,o){document.addEventListener("livewire:update",s=>{const a=parseFloat(o.dataset.lat),i=parseFloat(o.dataset.lng);if(!isNaN(a)&&!isNaN(i)){const r=e.getLatLng();if(Math.abs(r.lat-a)>1e-6||Math.abs(r.lng-i)>1e-6){const l=d.latLng(a,i);e.setLatLng(l),t.panTo(l)}}}),new MutationObserver(s=>{s.forEach(a=>{if(a.type==="attributes"&&(a.attributeName==="data-lat"||a.attributeName==="data-lng")){const i=parseFloat(o.dataset.lat),r=parseFloat(o.dataset.lng);if(!isNaN(i)&&!isNaN(r)){const l=e.getLatLng();if(Math.abs(l.lat-i)>1e-6||Math.abs(l.lng-r)>1e-6){const m=d.latLng(i,r);e.setLatLng(m),t.panTo(m)}}}})}).observe(o,{attributes:!0,attributeFilter:["data-lat","data-lng"]})}function M(){return{async handleSubmit(){try{if(!window.recaptcha||typeof window.recaptcha.getToken!="function"){this.$wire.call("submit");return}const t=await window.recaptcha.getToken("edit_request_submit");this.$wire.call("submit",t)}catch(t){console.error("âŒ reCAPTCHA error in Alpine:",t),this.$wire.call("handleRecaptchaError",t.message)}}}}window.editRequestForm=M;let c=null;function u(){const t=document.getElementById("edit-request-map");t&&!t.dataset.initialized&&(console.log("âœ… Initializing edit request map"),h(t),t.dataset.initialized="true",c&&(c.disconnect(),c=null))}function v(){c&&c.disconnect(),c=new MutationObserver(t=>{for(const e of t)for(const o of e.addedNodes)if(o.nodeType===Node.ELEMENT_NODE){if(o.id==="edit-request-map"){console.log("ğŸ“ Map container detected in DOM"),u();return}if(o.querySelector&&o.querySelector("#edit-request-map")){console.log("ğŸ“ Map container detected in DOM (nested)"),u();return}}}),c.observe(document.body,{childList:!0,subtree:!0}),console.log("ğŸ‘€ Map observer started")}document.addEventListener("DOMContentLoaded",()=>{b.init()?console.log("âœ… reCAPTCHA initialized for EditRequest"):console.warn("âš ï¸ Failed to initialize reCAPTCHA for EditRequest"),document.addEventListener("change",e=>{e.target.type==="checkbox"&&e.target.value==="coordinates"&&e.target.checked&&(console.log("ğŸ“ Coordinates checkbox checked"),document.getElementById("edit-request-map")?u():v())})});
