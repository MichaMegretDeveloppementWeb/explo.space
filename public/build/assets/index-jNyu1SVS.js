import{l as v,L as O}from"./leaflet-src-CT8H3qYi.js";class ut{constructor(){this.isSupported=this.checkSupport(),this.isLoading=!1}checkSupport(){return"geolocation"in navigator}async getCurrentPosition(){if(!this.isSupported){const i=new Error("geolocation.unsupported");throw i.messageKey="unsupported",i}if(this.isLoading){const i=new Error("geolocation.already_in_progress");throw i.messageKey="already_in_progress",i}this.isLoading=!0;try{const i=await new Promise((s,o)=>{navigator.geolocation.getCurrentPosition(s,o,{enableHighAccuracy:!0,timeout:15e3,maximumAge:3e5})});return{latitude:i.coords.latitude,longitude:i.coords.longitude,accuracy:i.coords.accuracy}}catch(i){throw this.handleGeolocationError(i)}finally{this.isLoading=!1}}handleGeolocationError(i){let s;switch(i.code){case i.PERMISSION_DENIED:s="permission_denied";break;case i.POSITION_UNAVAILABLE:s="position_unavailable";break;case i.TIMEOUT:s="request_timeout";break;default:s="unknown";break}const o=new Error(`geolocation.${s}`);return o.geolocationCode=i.code,o.messageKey=s,o}watchPosition(i,s=null){return this.isSupported?navigator.geolocation.watchPosition(i,s||this.handleGeolocationError.bind(this),{enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4}):(s&&s(new Error("Geolocation not supported")),null)}clearWatch(i){i!==null&&navigator.geolocation.clearWatch(i)}}function ct(){const p=new ut;function i(){Livewire.on("requestGeolocation",function(s){dt(p,s)})}typeof Livewire<"u"?i():document.addEventListener("livewire:init",()=>{i()})}async function dt(p,i){const{componentId:s}=i;try{const o=await p.getCurrentPosition();Livewire.dispatch("geolocationSuccess",{data:{latitude:o.latitude,longitude:o.longitude,accuracy:o.accuracy}})}catch(o){console.error("Geolocation error:",o),Livewire.dispatch("geolocationError",{data:{message:o.message}})}}const pt=window.PlaceSearchConfig?.map||{},et={tileLayer:{primary:{url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",attribution:"© OpenStreetMap contributors © CARTO",subdomains:["a","b","c","d"],maxZoom:19,minZoom:3},fallback:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",subdomains:["a","b","c","d"],attribution:"© OpenStreetMap contributors",maxZoom:19,minZoom:3}},clustering:{maxClusterRadius:110,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0,iconCreateFunction:function(p){const i=p.getChildCount();let s="small";return i>100?s="large":i>10&&(s="medium"),L.divIcon({html:`<div><span style="color: white;">${i}</span></div>`,className:`marker-cluster marker-cluster-${s}`,iconSize:L.point(40,40)})}},markers:{useDefaultLeafletIcons:!0},performance:{maxMarkersBeforeClustering:2,boundsUpdateDebounce:100,animationDuration:250},defaultView:{center:[48.8566,2.3522],zoom:6},worldBounds:pt.boundingBox||{north:85,south:-85,east:180,west:-180}};/*! leaflet.geodesic 2.7.2 - (c) Henry Thasler - https://github.com/henrythasler/Leaflet.Geodesic#readme */var Q=function(p,i){return Q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,o){s.__proto__=o}||function(s,o){for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(s[u]=o[u])},Q(p,i)};function it(p,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");Q(p,i);function s(){this.constructor=p}p.prototype=i===null?Object.create(i):(s.prototype=i.prototype,new s)}var A=function(){return A=Object.assign||function(i){for(var s,o=1,u=arguments.length;o<u;o++){s=arguments[o];for(var t in s)Object.prototype.hasOwnProperty.call(s,t)&&(i[t]=s[t])}return i},A.apply(this,arguments)};function G(p,i,s){if(s||arguments.length===2)for(var o=0,u=i.length,t;o<u;o++)(t||!(o in i))&&(t||(t=Array.prototype.slice.call(i,0,o)),t[o]=i[o]);return p.concat(t||Array.prototype.slice.call(i))}var ft=(function(){function p(i){this.options={wrap:!0,steps:3},this.ellipsoid={a:6378137,b:63567523142e-4,f:1/298.257223563},this.options=A(A({},this.options),i)}return p.prototype.toRadians=function(i){return i*Math.PI/180},p.prototype.toDegrees=function(i){return i*180/Math.PI},p.prototype.mod=function(i,s){var o=i%s;return o<0?o+s:o},p.prototype.wrap360=function(i){return 0<=i&&i<360?i:this.mod(i,360)},p.prototype.wrap=function(i,s){return s===void 0&&(s=360),-s<=i&&i<=s?i:this.mod(i+s,2*s)-s},p.prototype.direct=function(i,s,o,u){u===void 0&&(u=100);var t=this.toRadians(i.lat),e=this.toRadians(i.lng),n=this.toRadians(s),r=o,a=Number.EPSILON*1e3,h=this.ellipsoid,l=h.a,d=h.b,c=h.f,g=Math.sin(n),f=Math.cos(n),_=(1-c)*Math.tan(t),m=1/Math.sqrt(1+_*_),y=_*m,C=Math.atan2(_,f),w=m*g,x=1-w*w,M=x*(l*l-d*d)/(d*d),P=1+M/16384*(4096+M*(-768+M*(320-175*M))),E=M/1024*(256+M*(-128+M*(74-47*M))),k=r/(d*P),b=null,I=null,T=null,S=null,Z=null,z=0;do S=Math.cos(2*C+k),b=Math.sin(k),I=Math.cos(k),T=E*b*(S+E/4*(I*(-1+2*S*S)-E/6*S*(-3+4*b*b)*(-3+4*S*S))),Z=k,k=r/(d*P)+T;while(Math.abs(k-Z)>a&&++z<u);if(z>=u)throw new EvalError("Direct vincenty formula failed to converge after ".concat(u,` iterations 
                (start=`).concat(i.lat,"/").concat(i.lng,"; bearing=").concat(s,"; distance=").concat(o,")"));var B=y*b-m*I*f,F=Math.atan2(y*I+m*b*f,(1-c)*Math.sqrt(w*w+B*B)),D=Math.atan2(b*g,m*I-y*b*f),N=c/16*x*(4+c*(4-3*x)),q=D-(1-N)*c*w*(k+N*b*(S+N*I*(-1+2*S*S))),V=e+q,j=Math.atan2(w,-B);return{lat:this.toDegrees(F),lng:this.toDegrees(V),bearing:this.wrap360(this.toDegrees(j))}},p.prototype.inverse=function(i,s,o,u){o===void 0&&(o=100),u===void 0&&(u=!0);var t=i,e=s,n=this.toRadians(t.lat),r=this.toRadians(t.lng),a=this.toRadians(e.lat),h=this.toRadians(e.lng),l=Math.PI,d=Number.EPSILON,c=this.ellipsoid,g=c.a,f=c.b,_=c.f,m=h-r,y=(1-_)*Math.tan(n),C=1/Math.sqrt(1+y*y),w=y*C,x=(1-_)*Math.tan(a),M=1/Math.sqrt(1+x*x),P=x*M,E=Math.abs(m)>l/2||Math.abs(a-n)>l/2,k=m,b=null,I=null,T=E?l:0,S=0,Z=E?-1:1,z=null,B=1,F=null,D=1,N=null,q=null,V=0;do{if(b=Math.sin(k),I=Math.cos(k),z=M*b*(M*b)+(C*P-w*M*I)*(C*P-w*M*I),Math.abs(z)<d)break;S=Math.sqrt(z),Z=w*P+C*M*I,T=Math.atan2(S,Z),F=C*M*b/S,D=1-F*F,B=D!==0?Z-2*w*P/D:0,N=_/16*D*(4+_*(4-3*D)),q=k,k=m+(1-N)*_*F*(T+N*S*(B+N*Z*(-1+2*B*B)));var j=E?Math.abs(k)-l:Math.abs(k);if(j>l)throw new EvalError("λ > π")}while(Math.abs(k-q)>1e-12&&++V<o);if(V>=o){if(u)return this.inverse(i,new v.LatLng(s.lat,s.lng-.01),o,u);throw new EvalError("Inverse vincenty formula failed to converge after ".concat(o,` iterations 
                    (start=`).concat(i.lat,"/").concat(i.lng,"; dest=").concat(s.lat,"/").concat(s.lng,")"))}var U=D*(g*g-f*f)/(f*f),ot=1+U/16384*(4096+U*(-768+U*(320-175*U))),$=U/1024*(256+U*(-128+U*(74-47*U))),at=$*S*(B+$/4*(Z*(-1+2*B*B)-$/6*B*(-3+4*S*S)*(-3+4*B*B))),W=f*ot*(T-at),lt=Math.abs(z)<d?0:Math.atan2(M*b,C*P-w*M*I),ht=Math.abs(z)<d?l:Math.atan2(C*b,-w*M+C*P*I);return{distance:W,initialBearing:Math.abs(W)<d?NaN:this.wrap360(this.toDegrees(lt)),finalBearing:Math.abs(W)<d?NaN:this.wrap360(this.toDegrees(ht))}},p.prototype.intersection=function(i,s,o,u){var t=this.toRadians(i.lat),e=this.toRadians(i.lng),n=this.toRadians(o.lat),r=this.toRadians(o.lng),a=this.toRadians(s),h=this.toRadians(u),l=n-t,d=r-e,c=Math.PI,g=Number.EPSILON,f=2*Math.asin(Math.sqrt(Math.sin(l/2)*Math.sin(l/2)+Math.cos(t)*Math.cos(n)*Math.sin(d/2)*Math.sin(d/2)));if(Math.abs(f)<g)return i;var _=(Math.sin(n)-Math.sin(t)*Math.cos(f))/(Math.sin(f)*Math.cos(t)),m=(Math.sin(t)-Math.sin(n)*Math.cos(f))/(Math.sin(f)*Math.cos(n)),y=Math.acos(Math.min(Math.max(_,-1),1)),C=Math.acos(Math.min(Math.max(m,-1),1)),w=Math.sin(r-e)>0?y:2*c-y,x=Math.sin(r-e)>0?2*c-C:C,M=a-w,P=x-h;if(Math.sin(M)===0&&Math.sin(P)===0||Math.sin(M)*Math.sin(P)<0)return null;var E=-Math.cos(M)*Math.cos(P)+Math.sin(M)*Math.sin(P)*Math.cos(f),k=Math.atan2(Math.sin(f)*Math.sin(M)*Math.sin(P),Math.cos(P)+Math.cos(M)*E),b=Math.asin(Math.min(Math.max(Math.sin(t)*Math.cos(k)+Math.cos(t)*Math.sin(k)*Math.cos(a),-1),1)),I=Math.atan2(Math.sin(a)*Math.sin(k)*Math.cos(t),Math.cos(k)-Math.sin(t)*Math.sin(b)),T=e+I;return new v.LatLng(this.toDegrees(b),this.toDegrees(T))},p.prototype.midpoint=function(i,s){var o=this.toRadians(i.lat),u=this.toRadians(i.lng),t=this.toRadians(s.lat),e=this.toRadians(s.lng-i.lng),n={x:Math.cos(o),y:0,z:Math.sin(o)},r={x:Math.cos(t)*Math.cos(e),y:Math.cos(t)*Math.sin(e),z:Math.sin(t)},a={x:n.x+r.x,y:n.y+r.y,z:n.z+r.z},h=Math.atan2(a.z,Math.sqrt(a.x*a.x+a.y*a.y)),l=u+Math.atan2(a.y,a.x);return new v.LatLng(this.toDegrees(h),this.toDegrees(l))},p})(),nt=(function(){function p(i){var s;this.geodesic=new ft,this.steps=(s=i?.steps)!==null&&s!==void 0?s:3}return p.prototype.recursiveMidpoint=function(i,s,o){var u=[i,s],t=this.geodesic.midpoint(i,s);return o>0?(u.splice.apply(u,G([0,1],this.recursiveMidpoint(i,t,o-1),!1)),u.splice.apply(u,G([u.length-2,2],this.recursiveMidpoint(t,s,o-1),!1))):u.splice(1,0,t),u},p.prototype.line=function(i,s){return this.recursiveMidpoint(i,s,Math.min(8,this.steps))},p.prototype.multiLineString=function(i){for(var s=[],o=0,u=i;o<u.length;o++){for(var t=u[o],e=[],n=1;n<t.length;n++)e.splice.apply(e,G([e.length-1,1],this.line(t[n-1],t[n]),!1));s.push(e)}return s},p.prototype.lineString=function(i){return this.multiLineString([i])[0]},p.prototype.splitLine=function(i,s){var o={point:new v.LatLng(89.9,-180.0000001),bearing:180},u={point:new v.LatLng(89.9,180.0000001),bearing:180},t=new v.LatLng(i.lat,i.lng,i.alt),e=new v.LatLng(s.lat,s.lng,s.alt);t.lng=this.geodesic.wrap(t.lng,360),e.lng=this.geodesic.wrap(e.lng,360),e.lng-t.lng>180?e.lng=e.lng-360:e.lng-t.lng<-180&&(e.lng=e.lng+360);var n=[[new v.LatLng(t.lat,this.geodesic.wrap(t.lng,180),t.alt),new v.LatLng(e.lat,this.geodesic.wrap(e.lng,180),e.alt)]];if(t.lng>=-180&&t.lng<=180){if(e.lng<-180){var r=this.geodesic.inverse(t,e).initialBearing,a=this.geodesic.intersection(t,r,o.point,o.bearing);a&&(n=[[t,a],[new v.LatLng(a.lat,a.lng+360),new v.LatLng(e.lat,e.lng+360,e.alt)]])}else if(e.lng>180){var r=this.geodesic.inverse(t,e).initialBearing,a=this.geodesic.intersection(t,r,u.point,u.bearing);a&&(n=[[t,a],[new v.LatLng(a.lat,a.lng-360),new v.LatLng(e.lat,e.lng-360,e.alt)]])}}else if(e.lng>=-180&&e.lng<=180){if(t.lng<-180){var r=this.geodesic.inverse(t,e).initialBearing,a=this.geodesic.intersection(t,r,o.point,o.bearing);a&&(n=[[new v.LatLng(t.lat,t.lng+360,t.alt),new v.LatLng(a.lat,a.lng+360)],[a,e]])}else if(t.lng>180){var r=this.geodesic.inverse(t,e).initialBearing,a=this.geodesic.intersection(t,r,o.point,o.bearing);a&&(n=[[new v.LatLng(t.lat,t.lng-360,t.alt),new v.LatLng(a.lat,a.lng-360)],[a,e]])}}return n},p.prototype.splitMultiLineString=function(i){for(var s=[],o=0,u=i;o<u.length;o++){var t=u[o];if(t.length===1){s.push(t);continue}for(var e=[],n=1;n<t.length;n++){var r=this.splitLine(t[n-1],t[n]);e.pop(),e=e.concat(r[0]),r.length>1&&(s.push(e),e=r[1])}s.push(e)}return s},p.prototype.wrapMultiLineString=function(i){for(var s=[],o=0,u=i;o<u.length;o++){for(var t=u[o],e=[],n=null,r=0,a=t;r<a.length;r++){var h=a[r];if(n===null)e.push(new v.LatLng(h.lat,h.lng)),n=new v.LatLng(h.lat,h.lng);else{var l=Math.round((h.lng-n.lng)/360);e.push(new v.LatLng(h.lat,h.lng-l*360)),n=new v.LatLng(h.lat,h.lng-l*360)}}s.push(e)}return s},p.prototype.circle=function(i,s){for(var o=[],u=0;u<this.steps;u++){var t=this.geodesic.direct(i,360/this.steps*u,s);o.push(new v.LatLng(t.lat,t.lng))}return o.push(new v.LatLng(o[0].lat,o[0].lng)),o},p.prototype.splitCircle=function(i){var s=this.splitMultiLineString([i]);return s.length===3&&(s[2]=G(G([],s[2],!0),s[0],!0),s.shift()),s},p.prototype.distance=function(i,s){return this.geodesic.inverse(new v.LatLng(i.lat,this.geodesic.wrap(i.lng,180)),new v.LatLng(s.lat,this.geodesic.wrap(s.lng,180))).distance},p.prototype.multilineDistance=function(i){for(var s=[],o=0,u=i;o<u.length;o++){for(var t=u[o],e=0,n=1;n<t.length;n++)e+=this.distance(t[n-1],t[n]);s.push(e)}return s},p.prototype.updateStatistics=function(i,s){var o={distanceArray:[],totalDistance:0,points:0,vertices:0};o.distanceArray=this.multilineDistance(i),o.totalDistance=o.distanceArray.reduce(function(a,h){return a+h},0),o.points=0;for(var u=0,t=i;u<t.length;u++){var e=t[u];o.points+=e.reduce(function(a){return a+1},0)}o.vertices=0;for(var n=0,r=s;n<r.length;n++){var e=r[n];o.vertices+=e.reduce(function(h){return h+1},0)}return o},p})();function st(p){return typeof p=="object"&&p!==null&&"lat"in p&&"lng"in p&&typeof p.lat=="number"&&typeof p.lng=="number"}function rt(p){return p instanceof Array&&typeof p[0]=="number"&&typeof p[1]=="number"}function Y(p){return p instanceof v.LatLng||rt(p)||st(p)}function R(p){if(p instanceof v.LatLng)return p;if(rt(p))return new v.LatLng(p[0],p[1],p[2]);if(st(p))return new v.LatLng(p.lat,p.lng,p.alt);throw new Error("L.LatLngExpression expected. Unknown object found.")}function gt(p){var i=[],s=Y(p[0])?[p]:p,o=new Error("L.LatLngExpression[] | L.LatLngExpression[][] expected. Unknown object found.");if(!(s instanceof Array))throw o;for(var u=0,t=s;u<t.length;u++){var e=t[u];if(!(e instanceof Array))throw o;for(var n=[],r=0,a=e;r<a.length;r++){var h=a[r];if(!Y(h))throw o;n.push(R(h))}i.push(n)}return i}var J=(function(p){it(i,p);function i(s,o){var u=p.call(this,[],o)||this;return u.defaultOptions={wrap:!0,steps:3},u.statistics={distanceArray:[],totalDistance:0,points:0,vertices:0},u.points=[],v.Util.setOptions(u,A(A({},u.defaultOptions),o)),u.geom=new nt(u.options),s!==void 0&&u.setLatLngs(s),u}return i.prototype.updateGeometry=function(){var s=[];if(s=this.geom.multiLineString(this.points),this.statistics=this.geom.updateStatistics(this.points,s),this.options.wrap){var o=this.geom.splitMultiLineString(s);p.prototype.setLatLngs.call(this,o)}else p.prototype.setLatLngs.call(this,this.geom.wrapMultiLineString(s))},i.prototype.setLatLngs=function(s){return this.points=gt(s),this.updateGeometry(),this},i.prototype.addLatLng=function(s,o){var u=R(s);return this.points.length===0?this.points.push([u]):o===void 0?this.points[this.points.length-1].push(u):o.push(u),this.updateGeometry(),this},i.prototype.fromGeoJson=function(s){var o=[],u=[];return s.type==="FeatureCollection"?u=s.features:s.type==="Feature"?u=[s]:["MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"].includes(s.type)?u=[{type:"Feature",geometry:s,properties:{}}]:console.log('[Leaflet.Geodesic] fromGeoJson() - Type "'.concat(s.type,'" not supported.')),u.forEach(function(t){switch(t.geometry.type){case"MultiPoint":case"LineString":o=G(G([],o,!0),[v.GeoJSON.coordsToLatLngs(t.geometry.coordinates,0)],!1);break;case"MultiLineString":case"Polygon":o=G(G([],o,!0),v.GeoJSON.coordsToLatLngs(t.geometry.coordinates,1),!0);break;case"MultiPolygon":t.geometry.coordinates.forEach(function(e){o=G(G([],o,!0),v.GeoJSON.coordsToLatLngs(e,1),!0)});break;default:console.log('[Leaflet.Geodesic] fromGeoJson() - Type "'.concat(t.geometry.type,'" not supported.'))}}),o.length&&this.setLatLngs(o),this},i.prototype.distance=function(s,o){return this.geom.distance(R(s),R(o))},i})(v.Polyline),K=(function(p){it(i,p);function i(s,o){var u,t=p.call(this,[],o)||this;t.defaultOptions={wrap:!0,steps:24,fill:!0,noClip:!0},t.statistics={distanceArray:[],totalDistance:0,points:0,vertices:0},v.Util.setOptions(t,A(A({},t.defaultOptions),o));var e=t.options;return t.radius=(u=e.radius)!==null&&u!==void 0?u:1e3*1e3,t.center=s===void 0?new v.LatLng(0,0):R(s),t.geom=new nt(t.options),t.update(),t}return i.prototype.update=function(){var s=this.geom.circle(this.center,this.radius);if(this.statistics=this.geom.updateStatistics([[this.center]],[s]),this.statistics.totalDistance=this.geom.multilineDistance([s]).reduce(function(u,t){return u+t},0),this.options.wrap){var o=this.geom.splitCircle(s);p.prototype.setLatLngs.call(this,o)}else p.prototype.setLatLngs.call(this,s)},i.prototype.distanceTo=function(s){var o=R(s);return this.geom.distance(this.center,o)},i.prototype.setLatLng=function(s,o){this.center=R(s),this.radius=o??this.radius,this.update()},i.prototype.setRadius=function(s,o){this.radius=s,this.center=o?R(o):this.center,this.update()},i})(v.Polyline);typeof window.L<"u"&&(window.L.Geodesic=J,window.L.geodesic=function(){for(var p=[],i=0;i<arguments.length;i++)p[i]=arguments[i];return new(J.bind.apply(J,G([void 0],p,!1)))},window.L.GeodesicCircle=K,window.L.geodesiccircle=function(){for(var p=[],i=0;i<arguments.length;i++)p[i]=arguments[i];return new(K.bind.apply(K,G([void 0],p,!1)))});function mt(p,i,s={},o=null){const[u,t]=p,e=[];if(o===null){const l=i/1e3;l<=500?o=64:l<=2e3?o=96:l<=5e3?o=128:o=180}const r=i/6371e3,a=u*Math.PI/180,h=t*Math.PI/180;for(let l=0;l<o;l++){const c=360/o*l*Math.PI/180,g=Math.asin(Math.sin(a)*Math.cos(r)+Math.cos(a)*Math.sin(r)*Math.cos(c)),f=h+Math.atan2(Math.sin(c)*Math.sin(r)*Math.cos(a),Math.cos(r)-Math.sin(a)*Math.sin(g));let _=g*180/Math.PI,m=f*180/Math.PI;for(;m>180;)m-=360;for(;m<-180;)m+=360;_=Math.max(-90,Math.min(90,_)),e.push([_,m])}return O.polygon(e,{color:s.color||"#3b82f6",fillColor:s.fillColor||"#3b82f6",fillOpacity:s.fillOpacity!==void 0?s.fillOpacity:.1,weight:s.weight||2,opacity:s.opacity!==void 0?s.opacity:.6,smoothFactor:1})}function X(p,i,s){const o=s.getSize(),u=o.x,t=o.y,r=Math.min(u,t)*.8/2,a=40075016686e-3,h=i*Math.PI/180,l=a*Math.abs(Math.cos(h))/256,d=Math.log2(l*r/p),c=Math.max(1,Math.min(18,d));return Math.round(c)}class _t{constructor(i,s={}){this.containerId=i,this.map=null,this.tileLayer=null,this.options={...et,...s},this.isInitialized=!1,this.useFallbackTiles=!1,this.lastBoundingBox=null,this.useBoundingBox=!1,this.radiusCircle=null}init(i=null,s=null,o=null,u=!1){if(this.isInitialized)return this.map;this.useBoundingBox=u;const t=i&&s?[i,s]:this.options.defaultView.center,e=o??this.options.defaultView.zoom;return this.map=O.map(this.containerId,{center:t,zoom:e,zoomControl:!0,worldCopyJump:!1,maxBounds:[[-90,-180],[90,180]],maxBoundsViscosity:1}),this.loadTileLayer(),this.isInitialized=!0,this.map}loadTileLayer(){const i=this.options.tileLayer.fallback;this.options.tileLayer.fallback,this.tileLayer=O.tileLayer(i.url,{attribution:i.attribution,subdomains:i.subdomains,maxZoom:i.maxZoom,minZoom:i.minZoom}),this.tileLayer.on("tileerror",()=>{this.useFallbackTiles||this.switchToFallbackTiles()}),this.tileLayer.addTo(this.map)}switchToFallbackTiles(){this.useFallbackTiles=!0,this.tileLayer&&this.map.removeLayer(this.tileLayer);const i=this.options.tileLayer.fallback;this.tileLayer=O.tileLayer(i.url,{attribution:i.attribution,maxZoom:i.maxZoom,minZoom:i.minZoom}),this.tileLayer.addTo(this.map)}getBoundingBox(){if(!this.map)return null;const i=this.map.getBounds();return{north:i.getNorth(),south:i.getSouth(),east:i.getEast(),west:i.getWest()}}setView(i,s,o,u=!0){if(!this.map){console.error("Map not initialized");return}u?this.map.flyTo([i,s],o,{duration:this.options.performance.animationDuration/1e3}):this.map.setView([i,s],o)}fitBounds(i){if(!this.map||!i||i.length===0)return;const s=O.featureGroup(i);this.map.fitBounds(s.getBounds(),{padding:[50,50]})}invalidateSize(){this.map&&this.map.invalidateSize()}destroy(){this.map&&(this.removeRadiusCircle(),this.map.remove(),this.map=null,this.tileLayer=null,this.isInitialized=!1)}showRadiusCircle(i,s,o){if(!this.map){console.error("Map not initialized");return}this.removeRadiusCircle(),this.radiusCircle=mt([i,s],o,{color:"#3b82f6",fillColor:"#3b82f6",fillOpacity:.1,weight:2,opacity:.6}),this.radiusCircle.addTo(this.map)}removeRadiusCircle(){this.radiusCircle&&this.map&&(this.map.removeLayer(this.radiusCircle),this.radiusCircle=null)}updateRadiusCircle(i,s,o){if(!this.map){console.error("Map not initialized");return}this.showRadiusCircle(i,s,o)}getMap(){return this.map}centerOnLocation(i,s,o,u=!0){if(!this.map)return console.error("Map not initialized"),Promise.resolve();const t=X(o,i,this.map);return this.showRadiusCircle(i,s,o),new Promise(e=>{const n=()=>{this.map.off("moveend",n),e()};this.map.on("moveend",n),u?this.map.flyTo([i,s],t,{duration:this.options.performance.animationDuration/1e3}):this.map.setView([i,s],t),setTimeout(()=>{const r=this.map.getCenter(),a=this.map.getZoom();Math.abs(r.lat-i)<1e-6&&Math.abs(r.lng-s)<1e-6&&a===t&&(this.map.off("moveend",n),e())},10)})}showWorldView(i=!0){if(!this.map)return console.error("Map not initialized"),Promise.resolve();const s=[40,0],o=3;return this.removeRadiusCircle(),new Promise(u=>{const t=()=>{this.map.off("moveend",t),u()};this.map.on("moveend",t),i?this.map.flyTo(s,o,{duration:this.options.performance.animationDuration/1e3}):this.map.setView(s,o),setTimeout(()=>{const e=this.map.getCenter(),n=this.map.getZoom();Math.abs(e.lat-s[0])<1e-6&&Math.abs(e.lng-s[1])<1e-6&&n===o&&(this.map.off("moveend",t),u())},100)})}adjustZoomToRadius(i,s,o,u=!1){if(!this.map)return console.error("Map not initialized"),Promise.resolve();const t=X(o,i,this.map);return this.updateRadiusCircle(i,s,o),new Promise(e=>{const n=()=>{this.map.off("moveend",n),e()};this.map.on("moveend",n),u?this.map.flyTo([i,s],t,{duration:this.options.performance.animationDuration/1e3}):this.map.setView([i,s],t),setTimeout(()=>{const r=this.map.getCenter(),a=this.map.getZoom();Math.abs(r.lat-i)<1e-6&&Math.abs(r.lng-s)<1e-6&&a===t&&(this.map.off("moveend",n),e())},10)})}}var H={exports:{}},vt=H.exports,tt;function Lt(){return tt||(tt=1,(function(p,i){(function(s,o){o(i)})(vt,function(s){var o=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnEveryZoom:!1,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyShapePositions:null,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,n=this._zoom;if(t.__parent)for(;e.__parent._zoom>=n;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var n=this._featureGroup,r=this._nonPointGroup,a=this.options.chunkedLoading,h=this.options.chunkInterval,l=this.options.chunkProgress,d=t.length,c=0,g=!0,f;if(this._map){var _=new Date().getTime(),m=L.bind(function(){var C=new Date().getTime();for(this._map&&this._unspiderfy&&this._unspiderfy();c<d;c++){if(a&&c%200===0){var w=new Date().getTime()-C;if(w>h)break}if(f=t[c],f instanceof L.LayerGroup){g&&(t=t.slice(),g=!1),this._extractNonGroupLayers(f,t),d=t.length;continue}if(!f.getLatLng){r.addLayer(f),e||this.fire("layeradd",{layer:f});continue}if(!this.hasLayer(f)&&(this._addLayer(f,this._maxZoom),e||this.fire("layeradd",{layer:f}),f.__parent&&f.__parent.getChildCount()===2)){var x=f.__parent.getAllChildMarkers(),M=x[0]===f?x[1]:x[0];n.removeLayer(M)}}l&&l(c,d,new Date().getTime()-_),c===d?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(m,this.options.chunkDelay)},this);m()}else for(var y=this._needsClustering;c<d;c++){if(f=t[c],f instanceof L.LayerGroup){g&&(t=t.slice(),g=!1),this._extractNonGroupLayers(f,t),d=t.length;continue}if(!f.getLatLng){r.addLayer(f);continue}this.hasLayer(f)||y.push(f)}return this},removeLayers:function(t){var e,n,r=t.length,a=this._featureGroup,h=this._nonPointGroup,l=!0;if(!this._map){for(e=0;e<r;e++){if(n=t[e],n instanceof L.LayerGroup){l&&(t=t.slice(),l=!1),this._extractNonGroupLayers(n,t),r=t.length;continue}this._arraySplice(this._needsClustering,n),h.removeLayer(n),this.hasLayer(n)&&this._needsRemoving.push({layer:n,latlng:n._latlng}),this.fire("layerremove",{layer:n})}return this}if(this._unspiderfy){this._unspiderfy();var d=t.slice(),c=r;for(e=0;e<c;e++){if(n=d[e],n instanceof L.LayerGroup){this._extractNonGroupLayers(n,d),c=d.length;continue}this._unspiderfyLayer(n)}}for(e=0;e<r;e++){if(n=t[e],n instanceof L.LayerGroup){l&&(t=t.slice(),l=!1),this._extractNonGroupLayers(n,t),r=t.length;continue}if(!n.__parent){h.removeLayer(n),this.fire("layerremove",{layer:n});continue}this._removeLayer(n,!0,!0),this.fire("layerremove",{layer:n}),a.hasLayer(n)&&(a.removeLayer(n),n.clusterShow&&n.clusterShow())}return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var n=this._needsClustering.slice(),r=this._needsRemoving,a,h,l;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(n),h=n.length-1;h>=0;h--){for(a=!0,l=r.length-1;l>=0;l--)if(r[l].layer===n[h]){a=!1;break}a&&t.call(e,n[h])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(n){L.stamp(n)===t&&(e=n)}),e},hasLayer:function(t){if(!t)return!1;var e,n=this._needsClustering;for(e=n.length-1;e>=0;e--)if(n[e]===t)return!0;for(n=this._needsRemoving,e=n.length-1;e>=0;e--)if(n[e].layer===t)return!1;return!!(t.__parent&&t.__parent._group===this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){var n=this._map;typeof e!="function"&&(e=function(){});var r=function(){(n.hasLayer(t)||n.hasLayer(t.__parent))&&!this._inZoomAnimation&&(this._map.off("moveend",r,this),this.off("animationend",r,this),n.hasLayer(t)?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",r,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",r,this),this.on("animationend",r,this),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,n,r;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,n=this._needsRemoving.length;e<n;e++)r=this._needsRemoving[e],r.newlatlng=r.layer._latlng,r.layer._latlng=r.latlng;for(e=0,n=this._needsRemoving.length;e<n;e++)r=this._needsRemoving[e],this._removeLayer(r.layer,!0),r.layer._latlng=r.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),n=this._needsClustering,this._needsClustering=[],this.addLayers(n,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var n=t.length-1;n>=0;n--)if(t[n]===e)return t.splice(n,1),!0},_removeFromGridUnclustered:function(t,e){for(var n=this._map,r=this._gridUnclustered,a=Math.floor(this._map.getMinZoom());e>=a&&r[e].removeObject(t,n.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,n){t._latlng=e,this.removeLayer(t),t._latlng=n,this.addLayer(t)},_childMarkerDragEnd:function(t){var e=t.target.__dragStart;delete t.target.__dragStart,e&&this._moveChild(t.target,e,t.target._latlng)},_removeLayer:function(t,e,n){var r=this._gridClusters,a=this._gridUnclustered,h=this._featureGroup,l=this._map,d=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var c=t.__parent,g=c._markers,f;for(this._arraySplice(g,t);c&&(c._childCount--,c._boundsNeedUpdate=!0,!(c._zoom<d));)e&&c._childCount<=1?(f=c._markers[0]===t?c._markers[1]:c._markers[0],r[c._zoom].removeObject(c,l.project(c._cLatLng,c._zoom)),a[c._zoom].addObject(f,l.project(f.getLatLng(),c._zoom)),this._arraySplice(c.__parent._childClusters,c),c.__parent._markers.push(f),f.__parent=c.__parent,c._icon&&(h.removeLayer(c),n||h.addLayer(f))):c._iconNeedsUpdate=!0,c=c.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,n){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,n)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),n=" marker-cluster-";return e<10?n+="small":e<100?n+="medium":n+="large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.spiderfyOnMaxZoom,n=this.options.showCoverageOnHover,r=this.options.zoomToBoundsOnClick,a=this.options.spiderfyOnEveryZoom;(e||r||a)&&this.on("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),n&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){var e=t.layer,n=e;if(!(t.type==="clusterkeypress"&&t.originalEvent&&t.originalEvent.keyCode!==13)){for(;n._childClusters.length===1;)n=n._childClusters[0];n._zoom===this._maxZoom&&n._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),this.options.spiderfyOnEveryZoom&&e.spiderfy(),t.originalEvent&&t.originalEvent.keyCode===13&&this._map._container.focus()}},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.spiderfyOnMaxZoom,e=this.options.showCoverageOnHover,n=this.options.zoomToBoundsOnClick,r=this.options.spiderfyOnEveryZoom,a=this._map;(t||n||r)&&this.off("clusterclick clusterkeypress",this._zoomOrSpiderfy,this),e&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),a.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),n=this.options.maxClusterRadius,r=n;typeof n!="function"&&(r=function(){return n}),this.options.disableClusteringAtZoom!==null&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var a=t;a>=e;a--)this._gridClusters[a]=new L.DistanceGrid(r(a)),this._gridUnclustered[a]=new L.DistanceGrid(r(a));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var n=this._gridClusters,r=this._gridUnclustered,a=Math.floor(this._map.getMinZoom()),h,l;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=a;e--){h=this._map.project(t.getLatLng(),e);var d=n[e].getNearObject(h);if(d){d._addChild(t),t.__parent=d;return}if(d=r[e].getNearObject(h),d){var c=d.__parent;c&&this._removeLayer(d,!1);var g=new this._markerCluster(this,e,d,t);n[e].addObject(g,this._map.project(g._cLatLng,e)),d.__parent=g,t.__parent=g;var f=g;for(l=e-1;l>c._zoom;l--)f=new this._markerCluster(this,l,f),n[l].addObject(f,this._map.project(d.getLatLng(),l));c._addChild(f),this._removeFromGridUnclustered(d,e);return}r[e].addObject(t,h)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){if(this.options.removeOutsideVisibleBounds){if(L.Browser.mobile)return this._checkBoundsMaxLat(this._map.getBounds())}else return this._mapBoundsInfinite;return this._checkBoundsMaxLat(this._map.getBounds().pad(1))},_checkBoundsMaxLat:function(t){var e=this._maxLat;return e!==void 0&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(e._childCount===2){e._addToMap();var n=e.getAllChildMarkers();this._featureGroup.removeLayer(n[0]),this._featureGroup.removeLayer(n[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var n=t.getLayers(),r=0,a;for(e=e||[];r<n.length;r++){if(a=n[r],a instanceof L.LayerGroup){this._extractNonGroupLayers(a,e);continue}e.push(a)}return e},_overrideMarkerIcon:function(t){var e=t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}});return e}});L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var n=this._getExpandedVisibleBounds(),r=this._featureGroup,a=Math.floor(this._map.getMinZoom()),h;this._ignoreMove=!0,this._topClusterLevel._recursively(n,t,a,function(l){var d=l._latlng,c=l._markers,g;for(n.contains(d)||(d=null),l._isSingleParent()&&t+1===e?(r.removeLayer(l),l._recursivelyAddChildrenToMap(null,e,n)):(l.clusterHide(),l._recursivelyAddChildrenToMap(d,e,n)),h=c.length-1;h>=0;h--)g=c[h],n.contains(g._latlng)||r.removeLayer(g)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(n,e),r.eachLayer(function(l){!(l instanceof L.MarkerCluster)&&l._icon&&l.clusterShow()}),this._topClusterLevel._recursively(n,t,e,function(l){l._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(n,t,a,function(l){r.removeLayer(l),l.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var n=this,r=this._featureGroup;r.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){r.removeLayer(t),t.clusterShow(),n._animationEnd()})):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,n){var r=this._getExpandedVisibleBounds(),a=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(r,a,e+1,n);var h=this;this._forceLayout(),t._recursivelyBecomeVisible(r,n),this._enqueue(function(){if(t._childCount===1){var l=t._markers[0];this._ignoreMove=!0,l.setLatLng(l.getLatLng()),this._ignoreMove=!1,l.clusterShow&&l.clusterShow()}else t._recursively(r,n,a,function(d){d._recursivelyRemoveChildrenFromMap(r,a,e+1)});h._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)};var u=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(t,e,n,r){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),r&&this._addChild(r)},getAllChildMarkers:function(t,e){t=t||[];for(var n=this._childClusters.length-1;n>=0;n--)this._childClusters[n].getAllChildMarkers(t,e);for(var r=this._markers.length-1;r>=0;r--)e&&this._markers[r].__dragStart||t.push(this._markers[r]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e=this._childClusters.slice(),n=this._group._map,r=n.getBoundsZoom(this._bounds),a=this._zoom+1,h=n.getZoom(),l;e.length>0&&r>a;){a++;var d=[];for(l=0;l<e.length;l++)d=d.concat(e[l]._childClusters);e=d}r>a?this._group._map.setView(this._latlng,a):r<=h?this._group._map.setView(this._latlng,h+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t=this._markers,e=this._childClusters,n=0,r=0,a=this._childCount,h,l,d,c;if(a!==0){for(this._resetBounds(),h=0;h<t.length;h++)d=t[h]._latlng,this._bounds.extend(d),n+=d.lat,r+=d.lng;for(h=0;h<e.length;h++)l=e[h],l._boundsNeedUpdate&&l._recalculateBounds(),this._bounds.extend(l._bounds),d=l._wLatLng,c=l._childCount,n+=d.lat*c,r+=d.lng*c;this._latlng=this._wLatLng=new L.LatLng(n/a,r/a),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,n){this._recursively(t,this._group._map.getMinZoom(),n-1,function(r){var a=r._markers,h,l;for(h=a.length-1;h>=0;h--)l=a[h],l._icon&&(l._setPos(e),l.clusterHide())},function(r){var a=r._childClusters,h,l;for(h=a.length-1;h>=0;h--)l=a[h],l._icon&&(l._setPos(e),l.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,n,r){this._recursively(t,r,e,function(a){a._recursivelyAnimateChildrenIn(t,a._group._map.latLngToLayerPoint(a.getLatLng()).round(),n),a._isSingleParent()&&n-1===r?(a.clusterShow(),a._recursivelyRemoveChildrenFromMap(t,e,n)):a.clusterHide(),a._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(n){n.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,n){this._recursively(n,this._group._map.getMinZoom()-1,e,function(r){if(e!==r._zoom)for(var a=r._markers.length-1;a>=0;a--){var h=r._markers[a];n.contains(h._latlng)&&(t&&(h._backupLatlng=h.getLatLng(),h.setLatLng(t),h.clusterHide&&h.clusterHide()),r._group._featureGroup.addLayer(h))}},function(r){r._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var n=this._markers[e];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(t-1===this._zoom)for(var r=this._childClusters.length-1;r>=0;r--)this._childClusters[r]._restorePosition();else for(var a=this._childClusters.length-1;a>=0;a--)this._childClusters[a]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,n,r){var a,h;this._recursively(t,e-1,n-1,function(l){for(h=l._markers.length-1;h>=0;h--)a=l._markers[h],(!r||!r.contains(a._latlng))&&(l._group._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow())},function(l){for(h=l._childClusters.length-1;h>=0;h--)a=l._childClusters[h],(!r||!r.contains(a._latlng))&&(l._group._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow())})},_recursively:function(t,e,n,r,a){var h=this._childClusters,l=this._zoom,d,c;if(e<=l&&(r&&r(this),a&&l===n&&a(this)),l<e||l<n)for(d=h.length-1;d>=0;d--)c=h[d],c._boundsNeedUpdate&&c._recalculateBounds(),t.intersects(c._bounds)&&c._recursively(t,e,n,r,a)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}});L.Marker.include({clusterHide:function(){var t=this.options.opacity;return this.setOpacity(0),this.options.opacity=t,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var n=this._getCoord(e.x),r=this._getCoord(e.y),a=this._grid,h=a[r]=a[r]||{},l=h[n]=h[n]||[],d=L.Util.stamp(t);this._objectPoint[d]=e,l.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var n=this._getCoord(e.x),r=this._getCoord(e.y),a=this._grid,h=a[r]=a[r]||{},l=h[n]=h[n]||[],d,c;for(delete this._objectPoint[L.Util.stamp(t)],d=0,c=l.length;d<c;d++)if(l[d]===t)return l.splice(d,1),c===1&&delete h[n],!0},eachObject:function(t,e){var n,r,a,h,l,d,c,g=this._grid;for(n in g){l=g[n];for(r in l)for(d=l[r],a=0,h=d.length;a<h;a++)c=t.call(e,d[a]),c&&(a--,h--)}},getNearObject:function(t){var e=this._getCoord(t.x),n=this._getCoord(t.y),r,a,h,l,d,c,g,f,_=this._objectPoint,m=this._sqCellSize,y=null;for(r=n-1;r<=n+1;r++)if(l=this._grid[r],l){for(a=e-1;a<=e+1;a++)if(d=l[a],d)for(h=0,c=d.length;h<c;h++)g=d[h],f=this._sqDist(_[L.Util.stamp(g)],t),(f<m||f<=m&&y===null)&&(m=f,y=g)}return y},_getCoord:function(t){var e=Math.floor(t/this._cellSize);return isFinite(e)?e:t},_sqDist:function(t,e){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r}},(function(){L.QuickHull={getDistant:function(t,e){var n=e[1].lat-e[0].lat,r=e[0].lng-e[1].lng;return r*(t.lat-e[0].lat)+n*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var n=0,r=null,a=[],h,l,d;for(h=e.length-1;h>=0;h--){if(l=e[h],d=this.getDistant(l,t),d>0)a.push(l);else continue;d>n&&(n=d,r=l)}return{maxPoint:r,newPoints:a}},buildConvexHull:function(t,e){var n=[],r=this.findMostDistantPointFromBaseLine(t,e);return r.maxPoint?(n=n.concat(this.buildConvexHull([t[0],r.maxPoint],r.newPoints)),n=n.concat(this.buildConvexHull([r.maxPoint,t[1]],r.newPoints)),n):[t[0]]},getConvexHull:function(t){var e=!1,n=!1,r=!1,a=!1,h=null,l=null,d=null,c=null,g=null,f=null,_;for(_=t.length-1;_>=0;_--){var m=t[_];(e===!1||m.lat>e)&&(h=m,e=m.lat),(n===!1||m.lat<n)&&(l=m,n=m.lat),(r===!1||m.lng>r)&&(d=m,r=m.lng),(a===!1||m.lng<a)&&(c=m,a=m.lng)}n!==e?(f=l,g=h):(f=c,g=d);var y=[].concat(this.buildConvexHull([f,g],t),this.buildConvexHull([g,f],t));return y}}})(),L.MarkerCluster.include({getConvexHull:function(){var t=this.getAllChildMarkers(),e=[],n,r;for(r=t.length-1;r>=0;r--)n=t[r].getLatLng(),e.push(n);return L.QuickHull.getConvexHull(e)}}),L.MarkerCluster.include({_2PI:Math.PI*2,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(!(this._group._spiderfied===this||this._group._inZoomAnimation)){var t=this.getAllChildMarkers(null,!0),e=this._group,n=e._map,r=n.latLngToLayerPoint(this._latlng),a;this._group._unspiderfy(),this._group._spiderfied=this,this._group.options.spiderfyShapePositions?a=this._group.options.spiderfyShapePositions(t.length,r):t.length>=this._circleSpiralSwitchover?a=this._generatePointsSpiral(t.length,r):(r.y+=10,a=this._generatePointsCircle(t.length,r)),this._animationSpiderfy(t,a)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var n=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t),r=n/this._2PI,a=this._2PI/t,h=[],l,d;for(r=Math.max(r,35),h.length=t,l=0;l<t;l++)d=this._circleStartAngle+l*a,h[l]=new L.Point(e.x+r*Math.cos(d),e.y+r*Math.sin(d))._round();return h},_generatePointsSpiral:function(t,e){var n=this._group.options.spiderfyDistanceMultiplier,r=n*this._spiralLengthStart,a=n*this._spiralFootSeparation,h=n*this._spiralLengthFactor*this._2PI,l=0,d=[],c;for(d.length=t,c=t;c>=0;c--)c<t&&(d[c]=new L.Point(e.x+r*Math.cos(l),e.y+r*Math.sin(l))._round()),l+=a/r+c*5e-4,r+=h/l;return d},_noanimationUnspiderfy:function(){var t=this._group,e=t._map,n=t._featureGroup,r=this.getAllChildMarkers(null,!0),a,h;for(t._ignoreMove=!0,this.setOpacity(1),h=r.length-1;h>=0;h--)a=r[h],n.removeLayer(a),a._preSpiderfyLatlng&&(a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng),a.setZIndexOffset&&a.setZIndexOffset(0),a._spiderLeg&&(e.removeLayer(a._spiderLeg),delete a._spiderLeg);t.fire("unspiderfied",{cluster:this,markers:r}),t._ignoreMove=!1,t._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var n=this._group,r=n._map,a=n._featureGroup,h=this._group.options.spiderLegPolylineOptions,l,d,c,g;for(n._ignoreMove=!0,l=0;l<t.length;l++)g=r.layerPointToLatLng(e[l]),d=t[l],c=new L.Polyline([this._latlng,g],h),r.addLayer(c),d._spiderLeg=c,d._preSpiderfyLatlng=d._latlng,d.setLatLng(g),d.setZIndexOffset&&d.setZIndexOffset(1e6),a.addLayer(d);this.setOpacity(.3),n._ignoreMove=!1,n.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var n=this,r=this._group,a=r._map,h=r._featureGroup,l=this._latlng,d=a.latLngToLayerPoint(l),c=L.Path.SVG,g=L.extend({},this._group.options.spiderLegPolylineOptions),f=g.opacity,_,m,y,C,w,x;for(f===void 0&&(f=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),c?(g.opacity=0,g.className=(g.className||"")+" leaflet-cluster-spider-leg"):g.opacity=f,r._ignoreMove=!0,_=0;_<t.length;_++)m=t[_],x=a.layerPointToLatLng(e[_]),y=new L.Polyline([l,x],g),a.addLayer(y),m._spiderLeg=y,c&&(C=y._path,w=C.getTotalLength()+.1,C.style.strokeDasharray=w,C.style.strokeDashoffset=w),m.setZIndexOffset&&m.setZIndexOffset(1e6),m.clusterHide&&m.clusterHide(),h.addLayer(m),m._setPos&&m._setPos(d);for(r._forceLayout(),r._animationStart(),_=t.length-1;_>=0;_--)x=a.layerPointToLatLng(e[_]),m=t[_],m._preSpiderfyLatlng=m._latlng,m.setLatLng(x),m.clusterShow&&m.clusterShow(),c&&(y=m._spiderLeg,C=y._path,C.style.strokeDashoffset=0,y.setStyle({opacity:f}));this.setOpacity(.3),r._ignoreMove=!1,setTimeout(function(){r._animationEnd(),r.fire("spiderfied",{cluster:n,markers:t})},200)},_animationUnspiderfy:function(t){var e=this,n=this._group,r=n._map,a=n._featureGroup,h=t?r._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):r.latLngToLayerPoint(this._latlng),l=this.getAllChildMarkers(null,!0),d=L.Path.SVG,c,g,f,_,m,y;for(n._ignoreMove=!0,n._animationStart(),this.setOpacity(1),g=l.length-1;g>=0;g--)c=l[g],c._preSpiderfyLatlng&&(c.closePopup(),c.setLatLng(c._preSpiderfyLatlng),delete c._preSpiderfyLatlng,y=!0,c._setPos&&(c._setPos(h),y=!1),c.clusterHide&&(c.clusterHide(),y=!1),y&&a.removeLayer(c),d&&(f=c._spiderLeg,_=f._path,m=_.getTotalLength()+.1,_.style.strokeDashoffset=m,f.setStyle({opacity:0})));n._ignoreMove=!1,setTimeout(function(){var C=0;for(g=l.length-1;g>=0;g--)c=l[g],c._spiderLeg&&C++;for(g=l.length-1;g>=0;g--)c=l[g],c._spiderLeg&&(c.clusterShow&&c.clusterShow(),c.setZIndexOffset&&c.setZIndexOffset(0),C>1&&a.removeLayer(c),r.removeLayer(c._spiderLeg),delete c._spiderLeg);n._animationEnd(),n.fire("unspiderfied",{cluster:e,markers:l})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,n;for(e in t)for(n=t[e].__parent;n;)n._iconNeedsUpdate=!0,n=n.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,n;for(e in t)n=t[e],this.hasLayer(n)&&n.setIcon(this._overrideMarkerIcon(n))}}),L.Marker.include({refreshIconOptions:function(t,e){var n=this.options.icon;return L.setOptions(n,t),this.setIcon(n),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),s.MarkerClusterGroup=o,s.MarkerCluster=u,Object.defineProperty(s,"__esModule",{value:!0})})})(H,H.exports)),H.exports}Lt();class yt{constructor(i){this.map=i.getMap(),this.mapInstance=i,this.markers=[],this.markerClusterGroup=null,this.regularMarkerGroup=null,this.options=et,this.useClusteringCurrently=!1,this.initSvgDefs()}initSvgDefs(){if(document.getElementById("explo-map-svg-defs"))return;const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("id","explo-map-svg-defs"),i.style.position="absolute",i.style.width="0",i.style.height="0",i.style.visibility="hidden",i.innerHTML=`
            <defs>
                <!-- Filtre d'ombre portée pour marqueurs featured -->
                <filter id="marker-shadow-featured" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
                    <feOffset dx="0" dy="1" result="offsetblur"/>
                    <feComponentTransfer>
                        <feFuncA type="linear" slope="0.3"/>
                    </feComponentTransfer>
                    <feMerge>
                        <feMergeNode/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>

                <!-- Filtre d'ombre portée pour marqueurs normaux -->
                <filter id="marker-shadow-normal" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="1"/>
                    <feOffset dx="0" dy="1" result="offsetblur"/>
                    <feComponentTransfer>
                        <feFuncA type="linear" slope="0.3"/>
                    </feComponentTransfer>
                    <feMerge>
                        <feMergeNode/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            </defs>
        `,document.body.appendChild(i)}updateMarkers(i){if(!this.map){console.error("Map not initialized");return}this.clearMarkers(),i.length>=this.options.performance.maxMarkersBeforeClustering?this.createClusteredMarkers(i):this.createRegularMarkers(i)}createClusteredMarkers(i){this.useClusteringCurrently=!0,this.markerClusterGroup=O.markerClusterGroup({maxClusterRadius:this.options.clustering.maxClusterRadius,disableClusteringAtZoom:this.options.clustering.disableClusteringAtZoom,spiderfyOnMaxZoom:this.options.clustering.spiderfyOnMaxZoom,showCoverageOnHover:this.options.clustering.showCoverageOnHover,zoomToBoundsOnClick:this.options.clustering.zoomToBoundsOnClick,iconCreateFunction:s=>this.createClusterIcon(s)}),i.forEach(s=>{const o=this.createMarker(s);o&&(this.markerClusterGroup.addLayer(o),this.markers.push(o))}),this.map.addLayer(this.markerClusterGroup)}createRegularMarkers(i){this.useClusteringCurrently=!1,this.regularMarkerGroup=O.featureGroup(),i.forEach(s=>{const o=this.createMarker(s);o&&(this.regularMarkerGroup.addLayer(o),this.markers.push(o))}),this.map.addLayer(this.regularMarkerGroup)}createClusterIcon(i){const s=i.getChildCount();let o=40,u="13px",t=34;s>100?(o=56,u="17px",t=48):s>10&&(o=48,u="15px",t=40);const e=i.getAllChildMarkers().some(d=>d.placeData&&d.placeData.is_featured),l=`
            <div style="position: relative; width: ${o}px; height: ${o}px;">
                <!-- Cercle extérieur avec dégradé -->
                <div style="
                    position: absolute;
                    width: 100%;
                    height: 100%;
                    background: linear-gradient(135deg, ${e?"#a855f7":"#60a5fa"} 0%, ${e?"#9333ea":"#3b82f6"} 100%);
                    border-radius: 50%;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25), 0 0 0 3px rgba(255, 255, 255, 0.3);
                "></div>

                <!-- Cercle intérieur avec le nombre -->
                <div style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: ${t}px;
                    height: ${t}px;
                    background: ${e?"#7c3aed":"#2563eb"};
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: 700;
                    font-size: ${u};
                    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
                ">
                    ${s}
                </div>

                ${e?`
            <div style="
                position: absolute;
                top: -3px;
                right: -3px;
                background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
                border: 2.5px solid white;
                border-radius: 50%;
                width: 22px;
                height: 22px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
            ">
                <svg width="11" height="11" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
            </div>
        `:""}
            </div>
        `;return O.divIcon({html:l,className:"marker-cluster-custom",iconSize:O.point(o,o)})}getMarkerIcon(i){return i.is_featured?this.createFeaturedIcon(27,42):this.createNormalIcon(27,42)}createNormalIcon(i,s){const o=`
            <svg width="${i}" height="${s}" viewBox="-1 0 28 41" xmlns="http://www.w3.org/2000/svg">
                <!-- Pin bleu -->
                <path d="M12.5 0C5.6 0 0 5.6 0 12.5c0 1.9 0.4 3.7 1.2 5.3l11.3 23.2l11.3-23.2c0.8-1.6 1.2-3.4 1.2-5.3C25 5.6 19.4 0 12.5 0z"
                      fill="#3b82f6"
                      stroke="#ffffff00"
                      stroke-width="1.5"
                      filter="url(#marker-shadow-normal)"/>

                <!-- Point blanc au centre -->
                <circle cx="12.5" cy="12.5" r="5" fill="white"/>
            </svg>
        `;return O.divIcon({html:o,className:"normal-marker-icon",iconSize:[i,s],iconAnchor:[i/2,s],popupAnchor:[0,-s+5]})}createFeaturedIcon(i,s){const o=`
            <svg width="${i}" height="${s}" viewBox="-1 0 28 41" xmlns="http://www.w3.org/2000/svg">
                <!-- Pin violet -->
                <path d="M12.5 0C5.6 0 0 5.6 0 12.5c0 1.9 0.4 3.7 1.2 5.3l11.3 23.2l11.3-23.2c0.8-1.6 1.2-3.4 1.2-5.3C25 5.6 19.4 0 12.5 0z"
                      fill="#9333ea"
                      stroke="#ffffff00"
                      stroke-width="1.5"
                      filter="url(#marker-shadow-featured)"/>

                <!-- Cercle blanc au centre pour contraste -->
                <circle cx="12.5" cy="12.5" r="7" fill="white"/>

                <!-- Étoile violette au centre -->
                <path d="M12.5 7.5 L13.8 11.2 L17.8 11.2 L14.5 13.5 L15.8 17.2 L12.5 14.9 L9.2 17.2 L10.5 13.5 L7.2 11.2 L11.2 11.2 Z"
                      fill="#9333ea"
                      stroke="#6b21a8"
                      stroke-width="0.5"/>
            </svg>
        `;return O.divIcon({html:o,className:"featured-marker-icon",iconSize:[i,s],iconAnchor:[i/2,s],popupAnchor:[0,-s+5]})}createMarker(i){if(!i.latitude||!i.longitude)return console.warn("Invalid place coordinates",i),null;const s=O.marker([i.latitude,i.longitude],{icon:this.getMarkerIcon(i)});return s.placeData=i,s.on("click",()=>{this.onMarkerClick(i)}),s}onMarkerClick(i){window.Livewire&&window.Livewire.dispatch("marker-clicked",{placeId:i.id})}clearMarkers(){this.markerClusterGroup&&(this.map.removeLayer(this.markerClusterGroup),this.markerClusterGroup=null),this.regularMarkerGroup&&(this.map.removeLayer(this.regularMarkerGroup),this.regularMarkerGroup=null),this.markers=[],this.useClusteringCurrently=!1}findMarkerByPlaceId(i){return this.markers.find(s=>s.placeData&&s.placeData.id===i)||null}focusOnMarker(i,s=null){const o=this.findMarkerByPlaceId(i);if(o){const u=o.getLatLng(),t=this.map.getZoom(),e=s??Math.max(t,13);this.mapInstance.setView(u.lat,u.lng,e,!0)}}getMarkerCount(){return this.markers.length}isClusteringActive(){return this.useClusteringCurrently}getVisibleParent(i){const s=this.findMarkerByPlaceId(i);return s?!this.useClusteringCurrently||!this.markerClusterGroup?s:this.markerClusterGroup.getVisibleParent(s):null}isCluster(i){return i&&i instanceof O.MarkerCluster}}class Mt{constructor(i,s){this.mapInstance=i,this.markersInstance=s,this.map=i.getMap(),this.listContainer=null,this.highlightedMarker=null,this.originalIcon=null,this.highlightedCluster=null}init(i){if(this.listContainer=document.getElementById(i),!this.listContainer){console.error(`List container not found: ${i}`);return}this.setupListeners()}setupListeners(){this.listContainer.addEventListener("mouseenter",s=>{const o=s.target.closest("[data-place-id]");o&&this.onListItemHover(o)},!0),this.listContainer.addEventListener("mouseleave",()=>{this.resetHighlight()}),this.listContainer.addEventListener("click",s=>{const o=s.target.closest("[data-center-map]");if(o){const t=parseInt(o.dataset.centerMap,10);this.centerMapOnPlace(t),s.preventDefault();return}const u=s.target.closest("[data-place-id]");if(u&&!s.target.closest("a")){const t=parseInt(u.dataset.placeId,10);this.centerMapOnPlace(t)}});const i=()=>{Livewire.on("places-updated",()=>{this.resetHighlight()})};window.Livewire?i():document.addEventListener("livewire:init",i)}onListItemHover(i){const s=parseInt(i.dataset.placeId,10);if(!s)return;const o=this.markersInstance.getVisibleParent(s);o&&(this.markersInstance.isCluster(o)?this.highlightCluster(o):this.highlightMarker(o))}highlightMarker(i){this.resetHighlight(),this.originalIcon=i.getIcon(),this.highlightedMarker=i;const s=i.placeData&&i.placeData.is_featured;let o;s?o=O.divIcon({html:`
                <svg width="32" height="52" viewBox="-1 0 28 41" xmlns="http://www.w3.org/2000/svg">
                    <!-- Pin violet -->
                    <path d="M12.5 0C5.6 0 0 5.6 0 12.5c0 1.9 0.4 3.7 1.2 5.3l11.3 23.2l11.3-23.2c0.8-1.6 1.2-3.4 1.2-5.3C25 5.6 19.4 0 12.5 0z"
                          fill="#9333ea"
                          stroke="#ffffff00"
                          stroke-width="1.5"
                          filter="url(#marker-shadow-featured)"/>

                    <!-- Cercle blanc au centre pour contraste -->
                    <circle cx="12.5" cy="12.5" r="7" fill="white"/>

                    <!-- Étoile violette au centre -->
                    <path d="M12.5 7.5 L13.8 11.2 L17.8 11.2 L14.5 13.5 L15.8 17.2 L12.5 14.9 L9.2 17.2 L10.5 13.5 L7.2 11.2 L11.2 11.2 Z"
                          fill="#9333ea"
                          stroke="#6b21a8"
                          stroke-width="0.5"/>
                </svg>
            `,className:"featured-marker-icon highlighted",iconSize:[32,52],iconAnchor:[16,52],popupAnchor:[0,-47]}):o=O.divIcon({html:`
                <svg width="32" height="52" viewBox="-1 0 28 41" xmlns="http://www.w3.org/2000/svg">
                    <!-- Pin bleu -->
                    <path d="M12.5 0C5.6 0 0 5.6 0 12.5c0 1.9 0.4 3.7 1.2 5.3l11.3 23.2l11.3-23.2c0.8-1.6 1.2-3.4 1.2-5.3C25 5.6 19.4 0 12.5 0z"
                          fill="#3b82f6"
                          stroke="#ffffff00"
                          stroke-width="1.5"
                          filter="url(#marker-shadow-normal)"/>

                    <!-- Point blanc au centre -->
                    <circle cx="12.5" cy="12.5" r="5" fill="white"/>
                </svg>
            `,className:"normal-marker-icon highlighted",iconSize:[32,52],iconAnchor:[16,52],popupAnchor:[0,-47]}),i.setIcon(o),i.setZIndexOffset(1e3);const u=i._icon;if(u){u.classList.add("marker-highlighted");const t=s?"rgba(147, 51, 234, 0.6)":"rgba(59, 130, 246, 0.6)";u.style.filter=`drop-shadow(0 3px 6px ${t})`}}highlightCluster(i){this.resetHighlight(),this.highlightedCluster=i;const s=i._icon;s&&(s.classList.add("cluster-highlighted"),s.style.zIndex="1000")}resetHighlight(){if(this.highlightedMarker&&this.originalIcon){this.highlightedMarker.setIcon(this.originalIcon),this.highlightedMarker.setZIndexOffset(0);const i=this.highlightedMarker._icon;i&&(i.classList.remove("marker-highlighted"),i.style.filter=""),this.highlightedMarker=null,this.originalIcon=null}if(this.highlightedCluster){const i=this.highlightedCluster._icon;i&&(i.classList.remove("cluster-highlighted"),i.style.zIndex=""),this.highlightedCluster=null}}centerMapOnPlace(i){this.markersInstance.focusOnMarker(i,10),window.Livewire&&window.Livewire.dispatch("map-centered-on-place",{placeId:i})}destroy(){this.resetHighlight(),this.listContainer=null}reinit(i){this.destroy(),this.init(i)}}document.addEventListener("DOMContentLoaded",()=>{ct(),document.getElementById("place-explorer-container")&&new Ct});class Ct{constructor(){this.navbarHeight=64,this.placeMap=null,this.mapMarkers=null,this.mapSync=null,this.isInitializing=!0,this.isFilterChangeInProgress=!1,this.lastDispatchedBounds=null,this.internalDebounceTimer=null,this.finalDebounceTimer=null,this.isListUpdateInProgress=!1,this.pendingListUpdate=null,this.init()}async init(){this.setupNavbarHeight(),this.setupLivewireListeners(),await this.initializeMap()}setupNavbarHeight(){const i=()=>{const s=document.querySelector("nav")||document.querySelector("[data-navbar]")||document.querySelector("header")||document.querySelector(".navbar");s?this.navbarHeight=s.offsetHeight:this.navbarHeight=64;const o=document.getElementById("place-explorer-container");o&&(o.style.height=`calc(100vh - ${this.navbarHeight}px)`,document.documentElement.style.setProperty("--navbar-height",this.navbarHeight+"px"))};i(),window.addEventListener("resize",i),window.addEventListener("load",i)}async initializeMap(){const i=document.getElementById("place-map"),s=document.getElementById("map-loader");if(!i){console.warn("⚠️ Map container not found");return}const o=parseFloat(i.dataset.latitude)||null,u=parseFloat(i.dataset.longitude)||null,t=parseInt(i.dataset.radius,10)||null,e=this.parseMapPlaces(i.dataset.places),n=i.dataset.useBoundingBox==="true";this.placeMap=new _t("place-map"),this.placeMap.init(o,u,null,n),await new Promise(r=>{this.placeMap.getMap().whenReady(async()=>{if(o&&u&&t){const a=X(t,o,this.placeMap.getMap());this.placeMap.getMap().setView([o,u],a,{animate:!1}),this.placeMap.showRadiusCircle(o,u,t)}else await this.placeMap.showWorldView(!1);if(this.mapMarkers=new yt(this.placeMap),this.mapSync=new Mt(this.placeMap,this.mapMarkers),this.mapSync.init("place-list-results"),n){const a=this.placeMap.getMap().getBounds(),h={north:a.getNorth(),south:a.getSouth(),east:a.getEast(),west:a.getWest()};window.Livewire&&window.Livewire.dispatch("initial-map-bounds",{boundingBox:h})}else e&&e.length>0&&this.mapMarkers.updateMarkers(e);setTimeout(()=>{i.classList.remove("opacity-0"),i.classList.add("opacity-100"),s&&(s.classList.add("opacity-0"),setTimeout(()=>{s.style.display="none"},300))},100),r()})}),await this.waitForPlaceList(),this.emitInitialBounds(),this.setupMapChangeListeners(),setTimeout(()=>{this.isInitializing=!1},200)}parseMapPlaces(i){if(!i)return[];try{return JSON.parse(i)}catch(s){return console.error("Failed to parse places data",s),[]}}async waitForPlaceList(){return new Promise(i=>{if(document.getElementById("place-list-results")){setTimeout(i,100);return}const o=5e3,u=Date.now();let t=null;const e=new MutationObserver((n,r)=>{if(document.getElementById("place-list-results")){r.disconnect(),clearTimeout(t),setTimeout(i,100);return}Date.now()-u>o&&(r.disconnect(),clearTimeout(t),console.warn("⚠️ PlaceList component not found after 5s"),i())});e.observe(document.body,{childList:!0,subtree:!0}),t=setTimeout(()=>{e.disconnect(),document.getElementById("place-list-results")||console.warn("⚠️ PlaceList component not found after timeout"),i()},o)})}async emitInitialBounds(){const i=this.placeMap.getMap().getBounds(),s={north:i.getNorth(),south:i.getSouth(),east:i.getEast(),west:i.getWest()};window.Livewire&&window.Livewire.dispatch("initial-list-bounds",{boundingBox:s})}setupMapChangeListeners(){this.placeMap.getMap().on("moveend zoomend",()=>{this.isInitializing||this.isFilterChangeInProgress||(clearTimeout(this.internalDebounceTimer),this.internalDebounceTimer=setTimeout(()=>{clearTimeout(this.finalDebounceTimer),this.finalDebounceTimer=setTimeout(()=>{this.dispatchBoundingBoxChanged()},600)},200))})}dispatchBoundingBoxChanged(){const i=this.placeMap.getMap().getBounds(),s={north:i.getNorth(),south:i.getSouth(),east:i.getEast(),west:i.getWest()};if(!(this.lastDispatchedBounds&&!(Math.abs(this.lastDispatchedBounds.north-s.north)>1e-4||Math.abs(this.lastDispatchedBounds.south-s.south)>1e-4||Math.abs(this.lastDispatchedBounds.east-s.east)>1e-4||Math.abs(this.lastDispatchedBounds.west-s.west)>1e-4))){if(this.isListUpdateInProgress){this.pendingListUpdate=s;return}this.actuallyDispatchListUpdate(s)}}actuallyDispatchListUpdate(i,s=null){if(this.isListUpdateInProgress=!0,this.lastDispatchedBounds={...i},window.Livewire){const u=document.getElementById("place-map")?.dataset.useBoundingBox==="true",t=s?{boundingBox:i,filters:s}:{boundingBox:i};window.Livewire.dispatch("update-list-bounds",t),u&&window.Livewire.dispatch("update-map-bounds",t)}}setupLivewireListeners(){const i=()=>{Livewire.on("coordinates-updated",s=>{const o=s.coordinates||s[0]?.coordinates||[];this.mapMarkers&&this.mapMarkers.updateMarkers(o)}),Livewire.on("sync-filters-view",s=>{const{viewAction:o,filters:u,coordinates:t,useBoundingBox:e}=s[0]||s;this.handleFilterChange(o,u,t,e)}),Livewire.on("list-update-complete",()=>{if(this.isListUpdateInProgress=!1,this.pendingListUpdate){const s=this.pendingListUpdate;this.pendingListUpdate=null,s.filters!==void 0?this.actuallyDispatchListUpdate(s.boundingBox,s.filters):this.actuallyDispatchListUpdate(s)}})};window.addEventListener("sidebar:toggled",()=>{this.placeMap&&this.placeMap.invalidateSize()}),window.Livewire?i():document.addEventListener("livewire:init",i)}async handleFilterChange(i,s,o,u){try{clearTimeout(this.internalDebounceTimer),clearTimeout(this.finalDebounceTimer),this.isFilterChangeInProgress=!0,!u&&o&&this.mapMarkers.updateMarkers(o),i.action==="center-on-location"?await this.placeMap.centerOnLocation(i.latitude,i.longitude,i.radius,!0):i.action==="adjust-zoom"?await this.placeMap.adjustZoomToRadius(i.latitude,i.longitude,i.radius,!1):i.action==="show-world-view"&&await this.placeMap.showWorldView(!0);const t=this.placeMap.getMap().getBounds(),e={north:t.getNorth(),south:t.getSouth(),east:t.getEast(),west:t.getWest()};this.isListUpdateInProgress?this.pendingListUpdate={boundingBox:e,filters:s}:this.actuallyDispatchListUpdate(e,s),setTimeout(()=>{this.isFilterChangeInProgress=!1},500)}catch(t){console.error("❌ Error in handleFilterChange:",t),this.isFilterChangeInProgress=!1}}}
